<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SmartDent ERP — Reports</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    .card { @apply bg-white rounded-2xl shadow p-4; }
    .chart-wrap { height: 260px; }
  </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800 antialiased">

  <!-- Header -->
  <header class="bg-yellow-500 text-white py-4 shadow">
    <div class="container mx-auto px-4 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-full bg-white/90 flex items-center justify-center shadow">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#374151" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 3v6"></path><path d="M8 10s1 2 4 2 4-2 4-2"></path><path d="M6 21s2-4 6-4 6 4 6 4"></path>
          </svg>
        </div>
        <div class="font-semibold text-lg">SmartDent ERP</div>
      </div>
      <div class="flex items-center gap-3">
        <button class="bg-white/90 text-yellow-600 px-3 py-2 rounded-md inline-flex items-center gap-2 shadow-sm">
          <i data-feather="bar-chart-2"></i> Export Report
        </button>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="container mx-auto px-4 py-6 space-y-6">
    <div id="summary-cards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <!-- Dynamic summary cards will load here -->
    </div>

    <!-- Charts -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="card">
        <h3 class="font-semibold mb-2">Revenue Trend</h3>
        <div class="chart-wrap"><canvas id="revenueChart"></canvas></div>
      </div>
      <div class="card">
        <h3 class="font-semibold mb-2">Service Distribution</h3>
        <div class="chart-wrap"><canvas id="serviceChart"></canvas></div>
      </div>
    </div>

    <div class="card">
      <h3 class="font-semibold mb-2">Patient Growth</h3>
      <div class="chart-wrap"><canvas id="growthChart"></canvas></div>
    </div>
  </main>

  <footer class="mt-8 text-sm text-gray-500 text-center">
    SmartDent ERP • Insightful Reports for Smarter Decisions
  </footer>

  <script>
    feather.replace();

    async function loadReports() {
      try {
        const res = await fetch('/api/reports'); // your API endpoint
        const data = await res.json();

        // --- 1️⃣ Summary Cards ---
        document.getElementById('summary-cards').innerHTML = `
          <div class="card">
            <div class="text-sm text-gray-500">Total Patients</div>
            <div class="text-xl font-semibold">${data.totalPatients}</div>
            <div class="text-xs text-green-600 mt-1">${data.patientGrowth}% growth</div>
          </div>
          <div class="card">
            <div class="text-sm text-gray-500">Appointments</div>
            <div class="text-xl font-semibold">${data.todayAppointments} today</div>
            <div class="text-xs text-amber-600 mt-1">${data.pendingAppointments} pending</div>
          </div>
          <div class="card">
            <div class="text-sm text-gray-500">Revenue (YTD)</div>
            <div class="text-xl font-semibold">$${data.revenueYTD.toLocaleString()}</div>
            <div class="text-xs text-green-600 mt-1">${data.revenueChange}% vs last year</div>
          </div>
          <div class="card">
            <div class="text-sm text-gray-500">Stock Alerts</div>
            <div class="text-xl font-semibold">${data.lowStock}</div>
            <div class="text-xs text-gray-500 mt-1">Auto-reorder enabled</div>
          </div>
        `;

        // --- 2️⃣ Charts ---
        new Chart(document.getElementById('revenueChart').getContext('2d'), {
          type: 'line',
          data: {
            labels: data.revenueMonths,
            datasets: [{
              label: 'Revenue',
              data: data.revenueValues,
              borderColor: '#F59E0B',
              borderWidth: 3,
              tension: 0.4,
              pointRadius: 3,
              fill: false
            }]
          },
          options: { plugins: { legend: { display: false } }, responsive: true, maintainAspectRatio: false }
        });

        new Chart(document.getElementById('serviceChart').getContext('2d'), {
          type: 'doughnut',
          data: {
            labels: data.serviceLabels,
            datasets: [{
              data: data.serviceValues,
              backgroundColor: ['#60A5FA','#34D399','#FBBF24','#F87171','#A78BFA']
            }]
          },
          options: { plugins: { legend: { position: 'right' } }, responsive: true, maintainAspectRatio: false }
        });

        new Chart(document.getElementById('growthChart').getContext('2d'), {
          type: 'bar',
          data: {
            labels: data.patientMonths,
            datasets: [{
              label: 'New Patients',
              data: data.patientValues,
              backgroundColor: '#10B981'
            }]
          },
          options: { plugins: { legend: { display: false } }, responsive: true, maintainAspectRatio: false }
        });

      } catch (err) {
        console.error("❌ Failed to load reports:", err);
      }
    }

    loadReports();
  </script>
</body>
</html>
